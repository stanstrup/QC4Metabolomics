<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running the demo • MetabolomiQCsR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running the demo">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetabolomiQCsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/demo.html">Demo</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting started</h6></li>
    <li><a class="dropdown-item" href="../articles/demo.html">Running the demo</a></li>
    <li><a class="dropdown-item" href="../articles/setup_own_system.html">Running your own system</a></li>
    <li><a class="dropdown-item" href="../articles/file_move.html">Moving raw files automatically</a></li>
    <li><a class="dropdown-item" href="../articles/installing_docker_on_redhat.html">Installing Docker on RedHat</a></li>
    <li><a class="dropdown-item" href="../articles/scheduling.html">How are tasks scheduled?</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Maintainance</h6></li>
    <li><a class="dropdown-item" href="../articles/update_database.html">Upgrading the database version</a></li>
    <li><a class="dropdown-item" href="../articles/connect_to_db_from_R.html">Connect to DB in R</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/stanstrup/QC4Metabolomics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Running the demo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stanstrup/QC4Metabolomics/blob/master/vignettes/articles/demo.Rmd"><code>vignettes/articles/demo.Rmd</code></a></small>
      <div class="d-none name"><code>demo.Rmd</code></div>
    </div>

    
    
<p>Make sure to revisit the prerequisites on the front page.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="download-setup-files-and-use-pre-compiled-image">Download setup files and use pre-compiled image<a class="anchor" aria-label="anchor" href="#download-setup-files-and-use-pre-compiled-image"></a>
</h3>
<p>Make a folder where you want to install
<code>QC4Metabolomics</code>.<br></p>
<p><br></p>
<div class="section level4">
<h4 id="linuxwsl">Linux/WSL<a class="anchor" aria-label="anchor" href="#linuxwsl"></a>
</h4>
<p><strong>If you are using linux/WSL</strong>, navigate to the folder
you created and then run the following in a command-prompt, which will
download the demo data (or download manually from <a href="https://github.com/stanstrup/QC4Metabolomics/releases">github</a>),
and unzip the content:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">wget</span> https://github.com/stanstrup/QC4Metabolomics/releases/latest/download/QC4Metabolomics-demo.zip</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">unzip</span> QC4Metabolomics-demo.zip</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">rm</span>  QC4Metabolomics-demo.zip</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h4>
<p><strong>If you are using Windows</strong>, navigate to the folder you
created and then run the following in a command-prompt, which will
download the demo data (or download manually from <a href="https://github.com/stanstrup/QC4Metabolomics/releases">github</a>),
and unzip the content:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">curl.exe</span> <span class="at">-L</span> <span class="at">-o</span> QC4Metabolomics-demo.zip https://github.com/stanstrup/QC4Metabolomics/releases/latest/download/QC4Metabolomics-demo.zip</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xf</span> QC4Metabolomics-demo.zip</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">del</span> QC4Metabolomics-demo.zip</span></code></pre></div>
<p><br></p>
<p>Now you can launch the demo:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">docker</span> compose <span class="at">--file</span> docker-compose_demo.yml up <span class="at">--build</span> <span class="at">--force-recreate</span></span></code></pre></div>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="local-compilation">Local compilation<a class="anchor" aria-label="anchor" href="#local-compilation"></a>
</h3>
<p><strong>This is only useful if you want to modify the software
yourself.</strong> Otherwise move ahead to the next step.</p>
<p>Make sure to revisit the prerequisites on the front page.</p>
<p>First download the repository to somewhere convenient (here
<code>/opt</code>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="bu">cd</span> /opt</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">sudo</span> git lfs clone https://github.com/stanstrup/QC4Metabolomics.git</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="bu">cd</span> QC4Metabolomics</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="fu">sudo</span> chmod +x ./setup/<span class="pp">*</span>.sh</span></code></pre></div>
<p>Now you need to build the base image (used by several processes)
which requires downloading many R packages and will take a while.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-f</span> setup/Dockerfile_base <span class="at">-t</span> qc_base:local .</span></code></pre></div>
<p>You can now build the final containers. This will also start the
demo.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">docker</span> compose <span class="at">--file</span> docker-compose_demo_local_build.yml up <span class="at">--build</span> <span class="at">--force-recreate</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-started-with-the-demo">Getting started with the demo<a class="anchor" aria-label="anchor" href="#getting-started-with-the-demo"></a>
</h2>
<p>You can now open the demo in your browser by visiting
<code>localhost</code>. It might take a few minutes before it can load
though, since the database needs to be initialized on first load. If the
database is not initialized yet the console will show “Error : No tables
in the DB. Probably not done initializing.”.</p>
<p>Once the app loads you will see that no plots appear. This is because
no compounds to analyze has been defined.</p>
<p>First click the <code>Contaminants</code> tab. If no plot appears go
get a coffee and come back and reload the page (it will look for new
files every 1 min and then analyze the data). The plot is available when
the system has analyzed the demo files. Once a plot appears you can try
to change the “Minimum intensity in any sample” (for example to
10<sup>3</sup>). Now you can see which are the most common
contaminants.</p>
</div>
<div class="section level2">
<h2 id="track-specific-compounds">Track specific compounds<a class="anchor" aria-label="anchor" href="#track-specific-compounds"></a>
</h2>
<p>Now we want to make the tracking of specific analytes work. So go to
the <code>Track compounds</code> –&gt; <code>Compound settings</code>
tab. Now we fill in the data to track Tryptophan in both modes.<br>
These are the settings you need:</p>
<table class="table">
<thead><tr class="header">
<th>Compound name</th>
<th>Instrument</th>
<th>Mode</th>
<th>m/z</th>
<th>RT1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>L-Tryptophan</td>
<td>Sold</td>
<td>pos</td>
<td>188.0706</td>
<td>2.55</td>
</tr>
<tr class="even">
<td>L-Tryptophan</td>
<td>Sold</td>
<td>neg</td>
<td>203.0826</td>
<td>2.55</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>Click “Submit” when you have filled the form and repeat for the
second compound/mode.</p>
<p>When you are done it should look like this:</p>
<div class="figure" style="text-align: center">
<img src="trp_settings.png" alt="Settings to track tryptophan" width="100%"><p class="caption">
Settings to track tryptophan
</p>
</div>
<p>After some minutes you should be able reload the browser and see the
data for tryptophan in the “Track compounds” -&gt; “Compound stats”
tab.</p>
</div>
<div class="section level2">
<h2 id="enabling-email-warnings">Enabling email warnings<a class="anchor" aria-label="anchor" href="#enabling-email-warnings"></a>
</h2>
<p>By default the e-mail warnings are off, since you need to supply your
own email server settings to send e-mails.<br>
You can use GMail or any other SMTP server to send emails. If you use
GMail you need to create an “app password”, which can be done in your
GMail <a href="https://myaccount.google.com/apppasswords" class="external-link">account</a>,
and <em>not</em> use your regular GMail password.<br><br>
Once you have create your password you need to edit the settings for the
“Warner module”. You do that by opening the file
<code>settings_demo.env</code> and scrolling down to the section
“module: Warner”. First you enable the module by setting
<code>QC4METABOLOMICS_module_Warner_enabled</code> to
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_Warner_enabled</span><span class="ot">=</span><span class="kw">TRUE</span></span></code></pre></div>
<p>Next you need to set your credentials and server. Below is an example
where <code>EMAIL_SENDER</code> and <code>YOUR_USER</code> would be your
e-mail address for the account that <em>sends</em> the emails and
<code>EMAIL_RECEIVER</code> would be the address of the email that
should <em>receive</em> the emails (can be the same as the sender). The
password is the account password or in the case of GMail the “app
password”. Below are the settings needed for GMail.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_Warner_email_from</span><span class="ot">=</span><span class="st">EMAIL_SENDER</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_Warner_email_to</span><span class="ot">=</span><span class="st">EMAIL_RECEIVER</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_Warner_email_user</span><span class="ot">=</span><span class="st">YOUR_USER</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_Warner_email_password</span><span class="ot">=</span><span class="st">YOUR_PASSWORD</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_Warner_email_host</span><span class="ot">=</span><span class="st">smtp.gmail.com</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_Warner_email_port</span><span class="ot">=</span><span class="dv">587</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_Warner_email_use_ssl</span><span class="ot">=</span><span class="kw">TRUE</span></span></code></pre></div>
<p>You should now stop QC4Metabolomics (<code>ctrl + C</code>) and start
it again using:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">docker</span> compose <span class="at">--file</span> docker-compose_demo.yml up <span class="at">--build</span> <span class="at">--force-recreate</span></span></code></pre></div>
<p><br></p>
<p>Next go to the “Warning rules” tab and setup some rules. If the page
is empty wait up to 5 mins for the database to create the new tables the
Warner modules uses.<br></p>
<p>Any file that matches any of the rules will trigger an email. The
emails are send as soon as a matching file is found, but in bulk for all
newly found files and only once per file.<br></p>
<p>The rules only apply to files from a specific
<code>Instrument</code>, as extracted from the filename. Next you need
to select which statistic to monitor. Usually the most relevant
statistics are the <em>m/z</em> deviation from the expected
(<code>mz_dev_ppm</code>), the retention time deviation from the
expected in minutes (<code>rt_dev</code>) and the apex intensity
(<code>maxo</code>).<br>
You then choose the <code>operator</code> meaning the comparison to be
done. “Greater than” (<code>&gt;</code>) would be typical. Then the
<code>Value</code> to compare the statistic to needs to be chosen and
finally it should be decided if the absolute value of the
<code>Value</code> is to be considered instead of the raw (signed)
value.</p>
<p><br>
To check the system with the demo you could try these settings that will
trigger on all files where the <em>m/z</em> deviation is more than 30
ppm.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="16%">
<col width="16%">
<col width="16%">
<col width="16%">
<col width="16%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th>Rule Name</th>
<th>Instrument</th>
<th>Statistics</th>
<th>Operator</th>
<th>Value</th>
<th>Use absolute value?</th>
</tr></thead>
<tbody><tr class="odd">
<td>PPM out of range</td>
<td>Sold</td>
<td>mz_dev_ppm</td>
<td>&gt;</td>
<td>30</td>
<td>TRUE</td>
</tr></tbody>
</table>
<p><br></p>
<div class="figure" style="text-align: center">
<img src="warning_demo.png" alt="Settings to trigger warnings" width="100%"><p class="caption">
Settings to trigger warnings
</p>
</div>
</div>
<div class="section level2">
<h2 id="backups">Backups<a class="anchor" aria-label="anchor" href="#backups"></a>
</h2>
<p><code>QC4Metabolomics</code> automatically backs up your database to
the folder <code>backups</code>. Settings for the backup frequency can
be found at in the <code>DB backup</code> section in
<code>settings_demo.env</code>.<br><br></p>
<p>Refer to “Running your own system” for more explanation of
settings.</p>
</div>
<div class="section level2">
<h2 id="updating">Updating<a class="anchor" aria-label="anchor" href="#updating"></a>
</h2>
<p>Run the following to download the new images. Your docker-compose
file and settings should stay the same unless specifically stated.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">docker</span> compose <span class="at">--file</span> docker-compose_demo.yml pull</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Stanstrup.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
