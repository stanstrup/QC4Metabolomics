<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How are tasks scheduled? • MetabolomiQCsR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How are tasks scheduled?">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetabolomiQCsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/demo.html">Demo</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting started</h6></li>
    <li><a class="dropdown-item" href="../articles/demo.html">Running the demo</a></li>
    <li><a class="dropdown-item" href="../articles/setup_own_system.html">Running your own system</a></li>
    <li><a class="dropdown-item" href="../articles/file_move.html">Moving raw files automatically</a></li>
    <li><a class="dropdown-item" href="../articles/installing_docker_on_redhat.html">Installing Docker on RedHat</a></li>
    <li><a class="dropdown-item" href="../articles/scheduling.html">How are tasks scheduled?</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Maintainance</h6></li>
    <li><a class="dropdown-item" href="../articles/update_database.html">Upgrading the database version</a></li>
    <li><a class="dropdown-item" href="../articles/connect_to_db_from_R.html">Connect to DB in R</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/stanstrup/QC4Metabolomics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How are tasks scheduled?</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stanstrup/QC4Metabolomics/blob/master/vignettes/articles/scheduling.Rmd"><code>vignettes/articles/scheduling.Rmd</code></a></small>
      <div class="d-none name"><code>scheduling.Rmd</code></div>
    </div>

    
    
<p>When a new file is detected a cascade of tasks are started. This
document explains what happens under the hood. Refer to “Running your
own system” for more explanation of how new files are detected.</p>
<div class="section level2">
<h2 id="a-new-file-has-been-added--now-what">A new file has been added. Now what?<a class="anchor" aria-label="anchor" href="#a-new-file-has-been-added--now-what"></a>
</h2>
<p>The processing queue is a multi-step process that works the following
way:</p>
<ol style="list-style-type: decimal">
<li><p>Every 1 minute, given that no processing is already running, the
system starts all processing operations defined by all enabled modules
in prioritized order (<code>_process_order</code> defined in the
settings in your .env file). By default the following will
happen:</p></li>
<li><p>The module “Files” finds any new files (defined in a text file or
a monitored folder; refer to “Running your own system” for details),
calculates the MD5 checksum of the files and adds them to the database.
This is done 20 files at a time to avoid losing all results if an
unforeseen error in a few files causes the processing to fail. This runs
until all new files have been added to the database. This takes
approximately the time it takes to read the raw files for MD5 checksum
calculation; typically a few seconds per file with files ofa similar
size as in the demo.</p></li>
<li><p>The module “FileInfo” parses the filenames and extracts the true
analysis date/time. This is done for the newest files first in batches
of up to 200 files for the same reason of robustness as above.</p></li>
<li><p>The module “FileSchedule” schedules the files for processing by
all active modules that have file processing enabled
(<code>_schedule</code> in the .env file). Currently the three modules
that processes files are “TrackCmp”, “Contaminants” and the new
“Warner”. “TrackCmp” runs first.</p></li>
<li><p>The module “TrackCmp” processes files. The files are first sorted
by date and the newest files processed first, to make sure that the most
current data is presented first. A possible backlog (if for example old
files are added manually) of files are then processed.<br>
To reduce overhead while keeping memory usage predictable, 10 files are
processed together (meaning in the same call to the peak-picker) and a
maximum of 10 batches are processed before the system again checks (step
1) for possible new files that will then be prioritized.</p></li>
<li><p>The module “Contaminants” runs. Similarly to “TrackCmp”,
“Contaminants” analyses files in batches of 10 and writes intensity
values for all known contaminants to the database.</p></li>
<li><p>The module “Warner” runs. This is fast and considers all files at
once. Any file violation a rule will be mentioned in the generated
email. A file will only be warned about once.</p></li>
</ol>
<p><br><br></p>
<p>If you update settings in any of the modules (for example add more
compounds to track) the new settings are only applied going forward. If
you want to re-process the files already processed the processing queue
for those files need to be reset in the database (currently
manually).</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Stanstrup.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
