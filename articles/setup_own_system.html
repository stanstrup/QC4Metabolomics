<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running your own system • MetabolomiQCsR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running your own system">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetabolomiQCsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/demo.html">Demo</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting started</h6></li>
    <li><a class="dropdown-item" href="../articles/demo.html">Running the demo</a></li>
    <li><a class="dropdown-item" href="../articles/setup_own_system.html">Running your own system</a></li>
    <li><a class="dropdown-item" href="../articles/file_move.html">Moving raw files automatically</a></li>
    <li><a class="dropdown-item" href="../articles/installing_docker_on_redhat.html">Installing Docker on RedHat</a></li>
    <li><a class="dropdown-item" href="../articles/scheduling.html">How are tasks scheduled?</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Maintainance</h6></li>
    <li><a class="dropdown-item" href="../articles/update_database.html">Upgrading the database version</a></li>
    <li><a class="dropdown-item" href="../articles/connect_to_db_from_R.html">Connect to DB in R</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/stanstrup/QC4Metabolomics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Running your own system</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stanstrup/QC4Metabolomics/blob/master/vignettes/articles/setup_own_system.Rmd"><code>vignettes/articles/setup_own_system.Rmd</code></a></small>
      <div class="d-none name"><code>setup_own_system.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="prepare-files-with-your-new-configuration">Prepare files with your new configuration<a class="anchor" aria-label="anchor" href="#prepare-files-with-your-new-configuration"></a>
</h2>
<ol style="list-style-type: decimal">
<li>First install and run the <a href="demo.html">demo</a> and make sure
everything is working.</li>
<li>Make copies of <code>docker-compose_demo.yml</code> and
<code>settings_demo.env</code> and rename the copies to remove
<code>_demo</code> from the filenames.</li>
</ol>
</div>
<div class="section level2">
<h2 id="choose-what-processes-qc4metabolomics-should-run-and-correct-paths">Choose what processes QC4metabolomics should run and correct
paths<a class="anchor" aria-label="anchor" href="#choose-what-processes-qc4metabolomics-should-run-and-correct-paths"></a>
</h2>
<p>Open your newly created <code>docker-compose.yml</code> in a text
editor and modify to fit your system.<br>
The system consists of different “machines” that take care of different
parts of QC4Metabolomics:</p>
<ul>
<li>mariadb (required): runs the database that keep all the data.</li>
<li>qc_process (required): This runs the background processing of the
files that extracts the data.</li>
<li>qc_shiny (required): This runs the web interface that show you the
data.</li>
<li>ms_converter (optional): This is an automatic converter that takes
the raw vendor data and converts it into mzML files.</li>
<li>db-backup (optional): Automatic backup of the database</li>
</ul>
<p>First thing you do is replace every instance of
<code>settings_demo.env</code> with <code>settings.env</code> in your
new <code>docker-compose.yml</code>.<br>
Next you need to change several locations:</p>
<ul>
<li>under <code>mariadb</code> –&gt; <code>volumes</code> –&gt; change
<code>source</code> to the location to where the database files will be
kept.</li>
<li>under <code>qc_process</code> –&gt; <code>volumes</code> –&gt;
change <code>source</code> to the location of your data (where your mzML
files live).</li>
<li>under <code>qc_shiny</code> –&gt; <code>volumes</code> –&gt; change
<code>source</code> to the location of your data (where your mzML files
live).</li>
<li>under <code>ms_converter</code> –&gt; <code>volumes</code> –&gt;
change <code>source</code> to the location of your data (where your mzML
files live).</li>
<li>under <code>db-backup</code> –&gt; <code>volumes</code> –&gt; change
<code>source</code> to the location where you want your database backups
to be saved.</li>
</ul>
<p>If you do not want to use <code>ms_converter</code> or
<code>db-backup</code> you can remove those sections entirely.</p>
</div>
<div class="section level2">
<h2 id="general-settings">General settings<a class="anchor" aria-label="anchor" href="#general-settings"></a>
</h2>
<p>Now we can change settings in <code>settings.env</code> to fit your
specific needs.<br></p>
<p>The first setting is the time zone that can be adjusted so that
analysis times are displayed in the local time.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="dt">TZ</span><span class="ot">=</span><span class="st">Europe/Copenhagen</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="general-module-settings">General module settings<a class="anchor" aria-label="anchor" href="#general-module-settings"></a>
</h2>
<p>Next you will find that all modules modules have the sections:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_MODULENAME_enabled</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_MODULENAME_shiny_enabled</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_MODULENAME_schedule</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="dt">QC4METABOLOMICS_module_MODULENAME_file_schedule</span></span></code></pre></div>
<p>Normally you’d only need to change
<code>QC4METABOLOMICS_module_MODULENAME_enabled</code> that decides if
the module is loaded at all.<br></p>
<p>Some modules also have the setting
<code>QC4METABOLOMICS_module_MODULENAME_init_db_priority</code> that
decides in which order the module’s tables are created in the database
when the database is first created. Should not be touched.<br><code>QC4METABOLOMICS_module_MODULENAME_process_order</code> controls in
which order background processesing runs. Probably no need to change
these.</p>
<p>You can enable/disable parts of a module using these settings:</p>
<ul>
<li>
<code>QC4METABOLOMICS_module_MODULENAME_shiny_enabled</code>
enables/disables the interface for the module.</li>
<li>
<code>QC4METABOLOMICS_module_MODULENAME_schedule</code>
enables/disables the scheduled run on background processing.</li>
<li>
<code>QC4METABOLOMICS_module_MODULENAME_file_schedule</code> chooses
if this modules will be scheduled to work on individual files.</li>
</ul>
</div>
<div class="section level2">
<h2 id="specific-module-settings">Specific module settings<a class="anchor" aria-label="anchor" href="#specific-module-settings"></a>
</h2>
<div class="section level3">
<h3 id="files">Files<a class="anchor" aria-label="anchor" href="#files"></a>
</h3>
<ul>
<li>
<code>QC4METABOLOMICS_module_Files_include_ext</code>: When
determining which files to include choose only files matching these
extension (OR). Cannot be empty. Separated by <code>;</code>.</li>
<li>
<code>QC4METABOLOMICS_module_Files_include_path</code>: To be
included, the full path must include this string (AND). Can be
empty.</li>
<li>
<code>QC4METABOLOMICS_module_Files_exclude_path</code>: To be
included, the full path must <em>NOT</em> include this string (OR). Can
be empty.</li>
<li>
<code>QC4METABOLOMICS_module_Files_files_from_txt</code>: Chooses
whether or not files are found by traversing a folder or by reading a
text file that includes the exact paths. We recommend that you use a
text file that is updated as your analysis progresses as a deep folder
structure with thousands of files will become slow to traverse. Refer
also to “Moving raw files automatically” for a help script that moves
files and creates this index file.</li>
<li>
<code>QC4METABOLOMICS_module_Files_files_txt_path</code>: The path
to the text file that contains the path to the data files. The paths
should be relative to the data path as seen from inside the docker
image. that means that if you files are in
<code>d:\folder\mzML_files</code> and you mounted
<code>d:\folder\mzML_files</code> to <code>/data</code> in the docker
compose file then the paths would look like:
<code>/data/project name/mzML files/project name_date_instrument_sequence no_mode_sample name.mzML</code>.
Refer also to “Moving raw files automatically” for a help script that
moves files and creates this index file.</li>
</ul>
</div>
<div class="section level3">
<h3 id="fileinfo">FileInfo<a class="anchor" aria-label="anchor" href="#fileinfo"></a>
</h3>
<ul>
<li>
<code>QC4METABOLOMICS_module_FileInfo_mask</code>: This is very
important. This is the pattern of your file name. Required information
in the file name is <code>instrument</code>, <code>project</code>,
<code>mode</code> (if not using below workaround) and
<code>sample_id</code>. Other fields can be specified but are not
used.<br>
Example:
<code>%project%_%date%_%instrument%_%batch_seq_nr%_%mode%_%sample_id%</code>
</li>
<li>
<code>QC4METABOLOMICS_module_FileInfo_mode_from_other_field</code>:
If the mode is part of another “field” and not specified separately,
this setting can be enabled and the mode extracted.</li>
<li>
<code>QC4METABOLOMICS_module_FileInfo_mode_from_other_field_which</code>:
This is the field name the mode should be deduced from.</li>
<li>
<code>QC4METABOLOMICS_module_FileInfo_mode_from_other_field_pos_trigger</code>:
What string from the field name above should trigger the mode being set
to “pos”?</li>
<li>
<code>QC4METABOLOMICS_module_FileInfo_mode_from_other_field_neg_trigger</code>:
What string from the field name above should trigger the mode being set
to “neg”?</li>
</ul>
</div>
<div class="section level3">
<h3 id="trackcmp">TrackCmp<a class="anchor" aria-label="anchor" href="#trackcmp"></a>
</h3>
<ul>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_ROI_ppm</code>: When
subsetting the raw data how large a deviation from the target m/z is
allowed? This needs to be quite large since the deviation at the tails
of peaks is usually larger than expected. Only scans inside this window
is used. The centwave ppm setting will limit appropriately the peak
selected.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_method</code>:
selected peak picking method. Only <code>centWave</code> supported
ATM.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_snthr</code>: The
signal to noise threshold for a peak to be picked.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_ppm</code>: The ppm
tolerance for peak detection.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_peakwidth</code>:
The allowed peak with range in seconds. Should be two numbers separated
by comma.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_scanrange</code>:
The scan range to consider. Can be <code>NULL</code> to analyze the
whole file.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_prefilter</code>:
The prefilter settings for centWave. Refer to the CentWave for details.
Should be two numbers separated by comma. The first number says how many
scans need to be above the intensity given by the second number for a
peak to be picked.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_integrate</code>:
Integration method 1 or 2. Refer to the Centwave documentation.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_verbose_columns</code>:
Whether extra columns should be returned or not. Do not touch.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_findPeaks_fitgauss</code>:
Whether a gaussian curve should be fitted to the peak.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_xcmsRaw_profparam=</code>:
Profiling parameter for peak picking. Set to 0 to disable use of a
profile matrix. Do not touch.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_std_match_ppm</code>: The ppm
tolerance for matching the defined compounds to track.</li>
<li>
<code>QC4METABOLOMICS_module_TrackCmp_std_match_rt_tol</code>: The
retention time tolerance, in seconds, for matching the defined compounds
to track.</li>
</ul>
</div>
<div class="section level3">
<h3 id="contaminants">Contaminants<a class="anchor" aria-label="anchor" href="#contaminants"></a>
</h3>
<ul>
<li>
<code>QC4METABOLOMICS_module_Contaminants_cont_list_type</code>:
“URL” or “local”. Only URL supported at the moment.</li>
<li>
<code>QC4METABOLOMICS_module_Contaminants_cont_list_loc_positive</code>:The
URL/path to the positive mode contaminant list. The file should be a
tsv-file (tab delimited) containing the columns
<code>compound_ID</code>, <code>ion_ID</code>, <code>mode</code>,
<code>mz</code>, <code>anno</code>, <code>origin</code>.</li>
<li>
<code>QC4METABOLOMICS_module_Contaminants_cont_list_loc_unknown</code>:
The URL/path to the contaminant list for files where the mode is
unknown.</li>
<li>
<code>QC4METABOLOMICS_module_Contaminants_cont_list_loc_negative</code>:
The URL/path to the negative mode contaminant</li>
<li>
<code>QC4METABOLOMICS_module_Contaminants_EIC_ppm</code>: The ppm
tolerance for a mass peak to be included in the extracted ion
chromatogram the contaminant examination is based on. Should we wide to
include low intensity peaks.</li>
</ul>
</div>
<div class="section level3">
<h3 id="icmeter">ICMeter<a class="anchor" aria-label="anchor" href="#icmeter"></a>
</h3>
<ul>
<li>
<code>QC4METABOLOMICS_module_ICMeter_user</code>: The username for
the ICMeter system.</li>
<li>
<code>QC4METABOLOMICS_module_ICMeter_password</code>: The password
for the ICMeter system.</li>
</ul>
</div>
<div class="section level3">
<h3 id="warner">Warner<a class="anchor" aria-label="anchor" href="#warner"></a>
</h3>
<ul>
<li>
<code>QC4METABOLOMICS_module_Warner_email_from</code>: The email
address that will appear as the sender.</li>
<li>
<code>QC4METABOLOMICS_module_Warner_email_to</code>: The recepient
of the warning emails.</li>
<li>
<code>QC4METABOLOMICS_module_Warner_email_user=YOUR_USER</code>: The
username for the SMTP (outgoing) e-mail server. See “running the demo”
for more information.</li>
<li>
<code>QC4METABOLOMICS_module_Warner_email_password=YOUR_PASSWORD</code>:
The password for the SMTP (outgoing) e-mail server.</li>
<li>
<code>QC4METABOLOMICS_module_Warner_email_host</code>: The SMTP
server host address.</li>
<li>
<code>QC4METABOLOMICS_module_Warner_email_port</code>: The SMTP
server port number.</li>
<li>
<code>QC4METABOLOMICS_module_Warner_email_use_ssl</code>: If to use
SSL encryption with the mail server.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="settings-for-additional-tools">Settings for additional tools<a class="anchor" aria-label="anchor" href="#settings-for-additional-tools"></a>
</h2>
<div class="section level3">
<h3 id="ms-convert">MS convert<a class="anchor" aria-label="anchor" href="#ms-convert"></a>
</h3>
<p>The docker container ms_converter takes a text file named
<code>raw_filelist.txt</code> in the mounted folder, converts the files
to mzML and writes the new path to <code>mzML_filelist.txt</code> in the
mounted folder. It runs every minute to check for new files not yet
converted.</p>
<ul>
<li>
<code>QC4METABOLOMICS_msconvert_args</code>: settings msconvert from
ProteoWizard uses to convert the data. the default is
<code>--filter \"scanEvent 1\" --mzML --zlib --64</code>, which takes
only the first scanEvent (what Waters calls functions), outputs to mzML,
compresses using zlib and saves the values with 64 bit precision. Quotes
should be escaped with <code>\</code>.</li>
<li>
<code>QC4METABOLOMICS_msconvert_outdir_prefix</code>: The output
folder relative to the source files. the default, <code>/../mzML</code>,
steps one folder back, makes a new mzML folder and puts the converted
files there.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="internal-settings-for-advanced-users">Internal settings for advanced users<a class="anchor" aria-label="anchor" href="#internal-settings-for-advanced-users"></a>
</h2>
<p>These settings do not need to be changed but can be.</p>
<ul>
<li>
<code>QC4METABOLOMICS_base</code>: the data folder
<strong>internal</strong> to the docker images.</li>
<li>
<code>MYSQL_ROOT_PASSWORD</code>: The root database password.</li>
<li>
<code>MYSQL_DATABASE</code>: The name of the database.</li>
<li>
<code>MYSQL_USER</code>: The database user.</li>
<li>
<code>MYSQL_PASSWORD</code>: The database user’s password.</li>
<li>
<code>MYSQL_HOST</code>: The database host name. Needs to match with
the container name in docker-compose.yml.</li>
<li>
<code>MYSQL_PORT</code>: The database port number.</li>
<li>
<code>MARIADB_AUTO_UPGRADE</code>: Whether the database
automatically upgrades.</li>
</ul>
</div>
<div class="section level2">
<h2 id="db-backup">DB backup<a class="anchor" aria-label="anchor" href="#db-backup"></a>
</h2>
<p>This container automatically backs up the database regularly.</p>
<ul>
<li><p><code>TIMEZONE</code>: The time zone for correctly dating the
backup. Use a TZ identifier from the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" class="external-link">official
list</a>.</p></li>
<li><p><code>CONTAINER_NAME</code>: The database container name. Needs
to match with the container name in docker-compose.yml.</p></li>
<li><p><code>CONTAINER_ENABLE_MONITORING</code>: ??? The documentation
is unclear but this should nto be changed.</p></li>
<li><p><code>BACKUP_JOB_CONCURRENCY</code>: Number of concurrent backups
(if used with more than one database)</p></li>
<li><p><code>DEFAULT_CHECKSUM</code>: Whether to create
checksums</p></li>
<li><p><code>DEFAULT_BACKUP_INTERVAL</code>: Minutes between backups.
1440 minutes = 24 h.</p></li>
<li><p><code>DEFAULT_BACKUP_BEGIN</code>: Whether to make a backup at
lunch</p></li>
<li><p><code>DEFAULT_CLEANUP_TIME</code>: Number of hours to keep the
backups</p></li>
<li><p><code>DEFAULT_COMPRESSION</code>: Compression method used. Use
either Gzip <code>GZ</code>, Bzip2 <code>BZ</code>, XZip
<code>XZ</code>, ZSTD <code>ZSTD</code> or none
<code>NONE</code>.</p></li>
<li><p><code>DB01_TYPE</code>: Type of database</p></li>
<li><p><code>DB01_HOST</code>: The database host name. Needs to match
with the container name in docker-compose.yml.</p></li>
<li><p><code>DB01_NAME</code>: The name of the database.</p></li>
<li><p><code>DB01_USER</code>: The database user.</p></li>
<li><p><code>DB01_PASS</code>: The database user’s password.</p></li>
</ul>
<p>For more details refer to the <a href="https://github.com/tiredofit/docker-db-backup" class="external-link">image’s
documentation</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Stanstrup.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
